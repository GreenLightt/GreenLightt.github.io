---
title: Web 常见场景问题之 单点登录
date: 2018-01-31 22:08:41
description: 整理单点登录的解决方案
tags:
categories:
- Web FAQ
copyright: false
---

单点登录 `SSO`（`Single Sign On` ）说得简单点就是在一个多系统共存的环境下，用户在一处登录后，就不用在其他系统中登录，也就是用户的一次登录能得到其他所有系统的信任。单点登录在大型网站里使用得非常频繁，例如像阿里巴巴这样的网站，在网站的背后是成百上千的子系统，用户一次操作或交易可能涉及到几十个子系统的协作，如果每个子系统都需要用户认证，不仅用户会疯掉，各子系统也会为这种重复认证授权的逻辑搞疯掉。实现单点登录说到底就是要解决如何产生和存储那个信任，再就是其他系统如何验证这个信任的有效性，因此要点也就以下两个：

- 存储信任
- 验证信任

# 以 `Cookie` 作为凭证媒介

**条件：**

1. 各系统要同域
2. 各系统的`cookie` 的 `key` 值要相同
3. 各个后台的 `session` 信息要放一起，共享

![此处输入图片的描述][1]

只能保证单点登录，不能保证单点注销；

# 使用独立登录系统

## 登录 

相比于单系统登录，`sso` 需要一个独立的认证中心，只有认证中心能接受用户的用户名密码等安全信息，其他系统不提供登录入口，只接受认证中心的间接授权。间接授权通过令牌实现，`sso` 认证中心验证用户的用户名密码没问题，创建授权令牌，在接下来的跳转过程中，授权令牌作为参数发送给各个子系统，子系统拿到令牌，即得到了授权，可以借此创建局部会话，局部会话登录方式与单系统的登录方式相同。

![此处输入图片的描述][2]

用户登录成功之后，会与 `sso` 认证中心及各个子系统建立会话，用户与 `sso` 认证中心建立的会话称为全局会话，用户与各个子系统建立的会话称为局部会话，局部会话建立之后，用户访问子系统受保护资源将不再通过 `sso` 认证中心，全局会话与局部会话有如下约束关系:

- 局部会话存在，全局会话一定存在
- 全局会话存在，局部会话不一定存在
- 全局会话销毁，局部会话必须销毁

## **注销**

单点登录自然也要单点注销，在一个子系统中注销，所有子系统的会话都将被销毁，用下面的图来说明

![此处输入图片的描述][3]


  [1]: http://owk2q4gs5.bkt.clouddn.com/79702-b33138a8d24fc12b.jpg
  [2]: http://owk2q4gs5.bkt.clouddn.com/797930-20161203152650974-276822362.png
  [3]: http://owk2q4gs5.bkt.clouddn.com/797930-20161129155243068-1378377736.png
  
  
  
# 参考阅读

- [JC_Huang 单点登录的三种实现方式](https://www.jianshu.com/p/613e44d4a464)
- [单点登录原理与简单实现](https://www.cnblogs.com/ywlaker/p/6113927.html)
